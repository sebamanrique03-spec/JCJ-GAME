<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JCJ - PAGE</title>
<style>
body{margin:0;background:linear-gradient(to top,#1b1b1b,#2c2c2c);color:white;font-family:Arial,sans-serif;text-align:center;overflow-x:hidden;}
h1{margin:10px;text-shadow:2px 2px 5px black;font-size:2em;}
#gameArea{position:relative;width:90%;height:50vh;margin:10px auto;border:3px solid #fff;border-radius:10px;background:linear-gradient(to top,#3b3b3b,#555);overflow:hidden;}
.player{position:absolute;width:50px;height:50px;border-radius:8px;text-align:center;line-height:50px;font-weight:bold;color:white;box-shadow:0 0 10px rgba(0,0,0,0.7),inset 0 0 5px rgba(255,255,255,0.2);transition:left 0.05s,bottom 0.05s,background 0.1s;}
.player .eyes{position:absolute;top:10px;left:12px;width:25px;height:10px;display:flex;justify-content:space-between;}
.player .eyes div{width:6px;height:6px;background:white;border-radius:50%;}
.health-bar{position:absolute;top:-15px;height:10px;border-radius:5px;background:linear-gradient(to right,green,lime);transition:width 0.3s;border:1px solid #000;}
#cps{margin-top:5px;font-weight:bold;font-size:20px;text-shadow:1px 1px 2px black;}
button,.touchBtn{padding:12px 20px;margin:5px;font-weight:bold;border-radius:12px;cursor:pointer;font-size:16px;border:none;transition:transform 0.1s,box-shadow 0.1s;background:linear-gradient(to bottom,#888,#555);color:white;box-shadow:0 5px #222;user-select:none;}
button:hover,.touchBtn:hover{transform:scale(1.05);}
button:active,.touchBtn:active{transform:translateY(2px);box-shadow:0 3px #222;}
#result{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:60px;font-weight:bold;color:yellow;display:none;text-shadow:3px 3px 10px black,0 0 20px orange;}
#touchControls{margin-top:10px;}
#versionTag{position:absolute;bottom:5px;right:10px;font-weight:bold;font-size:16px;color:#ff0;text-shadow:1px 1px 3px black;}
.obstacle{position:absolute;bottom:0;height:50px;opacity:0.7;}
.obstacle.lava{background:red;}
.obstacle.web{background:cyan;}
#screenFlash{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;background:red;opacity:0;transition:opacity 0.1s;}
</style>
</head>
<body>
<h1>JCJ - PAGE</h1>
<div>
<button onclick="selectMode(0)">Demasiado F√°cil</button>
<button onclick="selectMode(1)">F√°cil</button>
<button onclick="selectMode(2)">Normal</button>
<button onclick="selectMode(3)">Dif√≠cil</button>
<button onclick="selectMode(4)">Extravagante</button>
<button onclick="selectMode(5)">IMPOSIBLE</button>
<button onclick="selectMode(6)">ULTRA</button>
</div>
<div id="kitSelection" style="margin-top:10px;"></div>
<div id="gameArea"></div>
<div id="screenFlash"></div>
<div id="result"></div>
<div id="cps">CPS: 0</div>
<div id="touchControls">
<button class="touchBtn" onclick="moveLeft()">‚óÄ</button>
<button class="touchBtn" onclick="moveRight()">‚ñ∂</button>
<button class="touchBtn" onclick="jump()">‚≠°</button>
<button class="touchBtn" onclick="attackPlayer()">‚öî</button>
<button class="touchBtn" onclick="useItem()">üçé/üß™</button>
<button class="touchBtn" onclick="toggleRun()">üèÉ</button>
<button class="touchBtn" onclick="placeLava(player.x)">üåã Lava</button>
<button class="touchBtn" onclick="placeWeb(player.x)">üï∏ Web</button>
<button class="touchBtn" onclick="toggleShield()">üõ°</button>
</div>
<div id="versionTag">v1.3.1</div>
<script>
const gameArea=document.getElementById('gameArea');
const cpsDiv=document.getElementById('cps');
const kitDiv=document.getElementById('kitSelection');
const resultDiv=document.getElementById('result');
const screenFlash=document.getElementById('screenFlash');

let player={x:50,y:0,vy:0,health:100,maxHealth:100,dmg:20,jumping:false,potions:0,goldApples:0,speed:10,running:false,hitRed:0,shieldActive:false,cooldown:false};
let enemy={x:300,y:0,vy:0,health:100,maxHealth:100,dmg:20,jumping:false,potions:0,goldApples:0,speed:10,hitRed:0,shieldActive:false,cooldown:false};
let obstacles=[],aiInterval,aiSpeed=5,aiAttackFreq=1500,aiCritChance=0.2,cps=0,selectedMode=1,currentKit=null;
const jumpHeight=100,gravity=3; let gameOver=false;

setInterval(()=>{ cpsDiv.textContent="CPS: "+cps; cps=0; },1000);
function addCPS(){ cps++; }

function selectMode(mode){
  selectedMode=mode; 
  resultDiv.style.display='none'; 
  if(mode===0)alert("Modo 'Demasiado F√°cil': imposible üòé"); 
  kitDiv.innerHTML="<h3>Elegir Kit:</h3>"; 
  ['NETH','DIAMOND','IRON','POT','TRAP','UHC','AXE'].forEach(k=>{kitDiv.innerHTML+=`<button onclick="selectKit('${k}')">${k}</button>`;});
}

function selectKit(kit){currentKit=kit; kitDiv.innerHTML=''; applyKit(kit); generateObstacles(); startGame(selectedMode);}
function applyKit(k){player.potions=0;player.goldApples=0;enemy.potions=0;enemy.goldApples=0;player.speed=10;enemy.speed=10;
if(k==='NETH'){player.maxHealth=150;player.health=150;player.dmg=15;enemy.maxHealth=150;enemy.health=150;enemy.dmg=15;}
if(k==='DIAMOND'){player.maxHealth=130;player.health=130;player.dmg=25;enemy.maxHealth=130;enemy.health=130;enemy.dmg=25;}
if(k==='IRON'){player.maxHealth=100;player.health=100;player.dmg=35;enemy.maxHealth=100;enemy.health=100;enemy.dmg=35;}
if(k==='POT'){player.maxHealth=100;player.health=100;player.dmg=20;player.potions=10;enemy.maxHealth=100;enemy.health=100;enemy.dmg=20;enemy.potions=10;}
if(k==='TRAP'){player.maxHealth=70;player.health=70;player.dmg=20;player.speed=5;enemy.maxHealth=100;enemy.health=100;enemy.dmg=25;}
if(k==='UHC'){player.maxHealth=80;player.health=80;player.dmg=40;player.potions=3;enemy.maxHealth=80;enemy.health=80;enemy.dmg=40;enemy.potions=3;}
if(k==='AXE'){player.maxHealth=90;player.health=90;player.dmg=50;player.goldApples=5;enemy.maxHealth=90;enemy.health=90;enemy.dmg=35;enemy.goldApples=5;}}

function generateObstacles(){obstacles=[]; if(currentKit==='TRAP'){for(let i=0;i<3;i++)obstacles.push({x:100+i*120,width:50,type:'lava'});for(let i=0;i<2;i++)obstacles.push({x:150+i*180,width:50,type:'web'});}}
function placeLava(x){if(currentKit==='UHC'||currentKit==='TRAP'){obstacles.push({x:x,width:50,type:'lava'});setTimeout(()=>{obstacles=obstacles.filter(o=>!(o.x===x&&o.type==='lava'));},5000);}}
function placeWeb(x){if(currentKit==='UHC'||currentKit==='TRAP'){obstacles.push({x:x,width:50,type:'web'});setTimeout(()=>{obstacles=obstacles.filter(o=>!(o.x===x&&o.type==='web'));},5000);}}
function toggleRun(){player.running=!player.running;}
function toggleShield(){if(currentKit==='AXE'){player.shieldActive=!player.shieldActive;}}
function regenHealthFor(e,s){let t=0; const i=setInterval(()=>{if(t>=s*2||e.health>=e.maxHealth){clearInterval(i);return;} e.health=Math.min(e.health+e.maxHealth*0.1,e.maxHealth); t++; render();},500);}
function useItem(){if(gameOver||player.cooldown)return;if(currentKit==='AXE'&&player.goldApples>0){player.goldApples--; regenHealthFor(player,5); player.cooldown=true; setTimeout(()=>{player.cooldown=false;},2000);} else if(currentKit==='POT'&&player.potions>0){player.potions--; regenHealthFor(player,5); player.cooldown=true; setTimeout(()=>{player.cooldown=false;},2000);}}

function startGame(m){clearInterval(aiInterval);player.x=50;player.y=0;player.vy=0;player.jumping=false;player.hitRed=0;player.shieldActive=false;enemy.x=300;enemy.y=0;enemy.vy=0;enemy.jumping=false;enemy.hitRed=0;enemy.shieldActive=false; resultDiv.style.display='none';gameOver=false;
switch(m){case 0: aiSpeed=1000; aiAttackFreq=10; aiCritChance=1; enemy.health=99999; enemy.maxHealth=99999; break; case 1: aiSpeed=25; aiAttackFreq=800; aiCritChance=0.4; break; case 2: aiSpeed=35; aiAttackFreq=700; aiCritChance=0.5; break; case 3: aiSpeed=50; aiAttackFreq=500; aiCritChance=0.6; break; case 4: aiSpeed=70; aiAttackFreq=400; aiCritChance=0.75; break; case 5: aiSpeed=100; aiAttackFreq=300; aiCritChance=0.85; break; case 6: aiSpeed=150; aiAttackFreq=150; aiCritChance=0.98; break;}
render(); aiInterval=setInterval(enemyAI,aiAttackFreq); requestAnimationFrame(gameLoop);}

// ü•ä Ataque con empuje y reach mejorado
function attack(a,d){
  if(gameOver) return;
  if(d.shieldActive){if(currentKit==='AXE'){d.shieldActive=false; d.hitRed=5;} return;}
  const reach=90; 
  if(Math.abs(a.x-d.x)<=reach){
    let dmg=a.dmg; if(a.jumping)dmg*=1.5;
    d.health-=dmg; if(d.health<0)d.health=0;
    let push=50; 
    if(a.x<d.x)d.x+=push; else d.x-=push;
    if(a.jumping)d.y+=30;
    d.hitRed=5;
    screenFlash.style.opacity=0.3; setTimeout(()=>{screenFlash.style.opacity=0;},100);
  }
}

function attackPlayer(){if(!player.shieldActive){attack(player,enemy); addCPS(); render(); checkWin();}}
function checkWin(){if(gameOver)return;if(player.health<=0){clearInterval(aiInterval);resultDiv.style.display='block';resultDiv.textContent="You ¬°LOSE!";gameOver=true;} else if(enemy.health<=0){clearInterval(aiInterval);resultDiv.style.display='block';resultDiv.textContent="You ¬°WIN!";gameOver=true;}}

function moveLeft(){if(gameOver)return; player.x=Math.max(0,player.x-(player.speed+(player.running?2:0)));render();}
function moveRight(){if(gameOver)return; player.x=Math.min(gameArea.clientWidth-50,player.x+(player.speed+(player.running?2:0)));render();}
function jump(){if(gameOver)return; if(!player.jumping){player.jumping=true;player.vy=15;render();}}

document.addEventListener('keydown',e=>{if(gameOver)return; const k=e.key.toLowerCase(); if(k==='a')moveLeft(); else if(k==='d')moveRight(); else if(k===' ')jump(); else if(k==='shift')toggleRun(); else if(k==='q')useItem(); else if(k==='e')placeLava(player.x); else if(k==='r')placeWeb(player.x); else if(k==='f')attackPlayer(); else if(k==='s')toggleShield();});

function render(){
  gameArea.innerHTML='';
  obstacles.forEach(o=>{const od=document.createElement('div'); od.className='obstacle '+o.type; od.style.left=o.x+'px'; od.style.width=o.width+'px'; od.style.bottom='0px'; gameArea.appendChild(od);});
  function createPlayerDiv(pl,color){
    const pd=document.createElement('div'); pd.className='player'; pd.style.left=pl.x+'px'; pd.style.bottom=pl.y+'px'; pd.style.background=(pl.hitRed>0)?'red':color;
    if(pl.shieldActive) pd.style.boxShadow='0 0 20px cyan';
    const eyes=document.createElement('div'); eyes.className='eyes'; eyes.innerHTML='<div></div><div></div>'; pd.appendChild(eyes);
    const hp=document.createElement('div'); hp.className='health-bar'; hp.style.width=(pl.health/pl.maxHealth*100)+'%'; pd.appendChild(hp);
    return pd;
  }
  gameArea.appendChild(createPlayerDiv(player,'red'));
  gameArea.appendChild(createPlayerDiv(enemy,'blue'));
}

function gameLoop(){
  if(gameOver)return;
  if(player.jumping||player.y>0){player.y+=player.vy;player.vy-=gravity;if(player.y<=0){player.y=0;player.jumping=false;player.vy=0;}}
  if(enemy.jumping||enemy.y>0){enemy.y+=enemy.vy;enemy.vy-=gravity;if(enemy.y<=0){enemy.y=0;enemy.jumping=false;enemy.vy=0;}}
  if(player.hitRed>0)player.hitRed--; if(enemy.hitRed>0)enemy.hitRed--;
  render(); checkWin(); requestAnimationFrame(gameLoop);
}

function enemyAI(){if(gameOver)return;if(selectedMode===0){enemy.x=player.x; enemy.y=player.y; attack(enemy,player); render(); return;}
if(enemy.x<player.x)enemy.x+=Math.min(aiSpeed,player.x-enemy.x); if(enemy.x>player.x)enemy.x-=Math.min(aiSpeed,enemy.x-player.x);
if(Math.random()<0.5&&!enemy.jumping)enemy.jumping=true; if((currentKit==='POT'||currentKit==='UHC'||currentKit==='AXE')&&enemy.goldApples>0&&enemy.health<=enemy.maxHealth*0.4){enemy.goldApples--; regenHealthFor(enemy,5);}
attack(enemy,player); checkWin();}
</script>
</body>
  </html>
